Using the codec
===============

Encoding
--------

```console
./vmc [--help] [-c config.cfg] [--parameter=value]
```

The encoder takes as input:

* Input meshes (e.g. `levi_voxelized/levi_fr%04d_qp12_qt13.obj`)

* Input textures (e.g. `levi_voxelized/levi_fr%04d.png`)

* Base meshes generated by the pre-processing pipeline (e.g.
  `preprocessed/levi_voxelized_r0.03_ld/levi_fr%04d_qp12_qt13.obj_base.obj`)

* Displaced subdivision meshes generated by the pre-processing pipeline (e.g.
  `preprocessed/levi_voxelized_r0.03_ld/levi_fr%04d_qp12_qt13.obj_subdiv.obj`)

* A group-of-frames structure file (e.g. `levi_voxelized.gof`)

Examples of [pre-processed meshes][url-cfp-preprocessed] and [group-of-frames
structure files][url-cfp-preprocessed] generated by the pre-processing
pipeline (See pre-processing pipeline, below) are available
at https://content.mpeg.expert/MPEG/CfP/Mesh/P11/preprocessed/

[url-cfp-preprocessed]: https://content.mpeg.expert/MPEG/CfP/Mesh/P11/preprocessed/
[url-cfp-gengof]: https://content.mpeg.expert/MPEG/CfP/Mesh/P11/gengof

The output of the encoder is a binary bitstream. Examples of compressed
bitstreams generated by the `vmc` encoder are available at
https://content.mpeg.expert/MPEG/CfP/Mesh/P11/bitstreams/


Decoding
--------

The decoder takes as input a compressed bitstream file and produces one or
more reconstructed OBJ/PNG files.


Configuration
-------------

The software may be configured using either command line arguments or from
a configuration file specified using the `-c|--config=` option.

Sample configuration files are provided in the `cfg/` directory.  The
utility <scripts/gen-cfg.sh> may be used to generate per sequence and per
rate point configuration files for a variety of common test conditions.

Parameters are set by the last value encountered on the command line.
Therefore if a setting is set via a configuration file, and then a
subsequent command line parameter changes that same setting, the command
line parameter value will be used.


Pre-processing pipeline
-----------------------

The pre-processing pipeline has the following steps:

1. Run `gengof` to generate the sequence's group-of-frames structure file.

   * Input: Original input meshes, e.g.
     `levi_voxelized/levi_fr%04d_qp12_qt13.obj`

   * Output: Group-of-frames structure file, e.g. `levi_voxelized.gof`

   * Example output: https://content.mpeg.expert/MPEG/CfP/Mesh/P11/gengof


2. Run `simplify` for each frame to generate decimated meshes.

   * Input: Input meshes, e.g. `levi_voxelized/levi_fr%04d_qp12_qt13.obj`.

   * Outputs:
      * Decimated meshes, e.g.
        `levi_voxelized_r0.03/levi_fr%04d_qp12_qt13.obj_decimated.obj`.

      * Reference meshes, e.g.
        `levi_voxelized_r0.03/levi_fr%04d_qp12_qt13.obj_reference.obj`

      * Mapped meshes, e.g.
        `levi_voxelized_r0.03/levi_fr%04d_qp12_qt13.obj_mapped.obj`

   * Example output: https://content.mpeg.expert/MPEG/CfP/Mesh/P11/decimated


3. Run `uvatlastool` for each frame to generate parameterized meshes.

   * Input: Input meshes, e.g.
     `levi_voxelized_r0.03/levi_fr%04d_qp12_qt13.obj_decimated.obj`.

   * Output: parameterized mesh, e.g.
     `levi_voxelized_r0.03/levi_fr%04d_qp12_qt13.obj_decimated_tex.obj`.

   * Example output: https://content.mpeg.expert/MPEG/CfP/Mesh/P11/uvatlas


4. Run `fibsubdiv` to generate bases meshes and displaced subdivision meshes

   * Inputs:
      * Group-of-frames structure file, e.g. `levi_voxelized.gof`.

      * Input meshes, e.g.
        `levi_voxelized_r0.03/levi_fr%04d_qp12_qt13.obj_decimated.obj`.

      * Decimated, parametrized meshes, e.g.
        `levi_voxelized_r0.03/levi_fr%04d_qp12_qt13.obj_decimated_tex.obj`.

   * Outputs:
      * Updated group-of-frames structure file, e.g.
        `levi_voxelized_r0.03_ld/levi_voxelized.gof`

      * Base meshes, e.g.
        `levi_voxelized_r0.03_ai/levi_fr%04d_qp12_qt13.obj_base.obj`

      * Displaced subdivision meshes, e.g.
        `levi_voxelized_r0.03_ai/levi_fr%04d_qp12_qt13.obj_subdiv.obj`

   * Example output: https://content.mpeg.expert/MPEG/CfP/Mesh/P11/preprocessed/
